<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Typing Speed Test — Modern UI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: 245 245 248;
      --card: 255 255 255;
      --text: 20 20 25;
      --muted: 110 110 130;
      --brand: 99 102 241; /* indigo */
      --good: 16 185 129;  /* emerald */
      --warn: 234 179 8;   /* amber */
      --bad: 239 68 68;    /* red */
      --glass: 255 255 255 / 0.6;
      --shadow: 30 30 60 / 0.08;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: rgb(var(--text));
      background: radial-gradient(1200px 800px at 10% -20%, rgba(99,102,241,.15), transparent),
                  radial-gradient(900px 600px at 110% 20%, rgba(16,185,129,.18), transparent),
                  rgb(var(--bg));
    }
    .wrap{max-width:1100px;margin:40px auto;padding:0 20px}
    .header{
      display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:20px
    }
    .title{font-weight:800;letter-spacing:-0.02em;font-size:clamp(22px,3vw,30px)}
    .subtitle{color:rgb(var(--muted));font-size:14px}
    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{appearance:none;border:0;padding:12px 14px;border-radius:16px;background:rgb(var(--text)/0.92);color:white;font-weight:600;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,.12);transition:.2s transform,.2s box-shadow}
    .btn:hover{transform:translateY(-1px);box-shadow:0 14px 40px rgba(0,0,0,.15)}
    .btn.secondary{background:rgb(99 102 241)}
    .btn.ghost{background:transparent;color:rgb(var(--text));border:1px solid rgba(0,0,0,.08)}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    .row{display:grid;grid-template-columns:1.3fr .7fr;gap:20px}
    @media(max-width:900px){.row{grid-template-columns:1fr}}

    .card{background:rgba(var(--glass));backdrop-filter: blur(10px);border-radius:24px;box-shadow:0 20px 60px rgba(var(--shadow));border:1px solid rgba(0,0,0,.06)}
    .card .hd{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid rgba(0,0,0,.06)}
    .card .hd h3{margin:0;font-size:16px;font-weight:700}
    .card .bd{padding:18px 20px}

    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{padding:8px 12px;border-radius:999px;background:rgba(0,0,0,.06);font-size:12px;color:rgb(var(--muted));font-weight:600}

    .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media(max-width:700px){.metrics{grid-template-columns:repeat(2,1fr)}}
    .metric{padding:16px;border-radius:18px;background:white;border:1px solid rgba(0,0,0,.06);box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .metric h4{margin:0 0 6px 0;font-size:12px;color:rgb(var(--muted));font-weight:700;letter-spacing:.06em;text-transform:uppercase}
    .metric .v{font-size:28px;font-weight:800}

    .prompt{font-size:18px;line-height:1.7;user-select:none}
    .prompt .char{padding:2px 0;border-radius:4px}
    .char.correct{color:rgb(34 197 94)}
    .char.wrong{background:rgb(239 68 68 / .08);color:rgb(239 68 68);text-decoration: none;border-bottom:2px solid rgb(239 68 68 / .4)}
    .char.active{outline:2px solid rgba(99,102,241,.35);outline-offset:2px;border-radius:6px}
    .char.pending{color:rgb(var(--muted))}

    .io{display:grid;grid-template-columns:1fr;gap:12px}
    textarea{
      width:100%;min-height:140px;resize:vertical;padding:16px;border-radius:18px;border:1px solid rgba(0,0,0,.08);font-size:16px;line-height:1.6;box-shadow:inset 0 1px 0 rgba(255,255,255,.6), 0 6px 20px rgba(0,0,0,.06);
    }

    .range{position:relative;height:10px;background:linear-gradient(90deg, rgba(99,102,241,.25), rgba(16,185,129,.25));border-radius:999px;overflow:hidden}
    .bar{position:absolute;inset:0;transform-origin:left;transform:scaleX(0)}
    .bar::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,rgb(99 102 241),rgb(16 185 129));opacity:.9}

    .lists{display:grid;grid-template-columns:1fr;gap:14px}
    .list h4{margin:0 0 8px 0;font-size:13px;color:rgb(var(--muted));text-transform:uppercase;letter-spacing:.08em}
    .list ul{margin:0;padding-left:18px}
    .list li{margin:6px 0}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
    .pill.good{background:rgb(16 185 129 / .12);color:rgb(16 185 129)}
    .pill.bad{background:rgb(239 68 68 / .12);color:rgb(239 68 68)}
    .pill.warn{background:rgb(234 179 8 / .12);color:rgb(180 130 3)}

    .footer{margin-top:24px;color:rgb(var(--muted));font-size:12px;text-align:center}
    .select, .input{
      padding:10px 12px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:white;font-weight:600
    }
    .toggle{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid rgba(0,0,0,.08);border-radius:999px;background:white;font-weight:700}
    .toggle input{accent-color:rgb(99 102 241)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <div class="title">⌨️ Typing Speed Test</div>
        <div class="subtitle">Modern, single‑file app with live accuracy, spelling & light grammar hints.</div>
      </div>
      <div class="controls">
        <select id="duration" class="select" title="Duration">
          <option value="30">30s</option>
          <option value="60" selected>60s</option>
          <option value="120">120s</option>
        </select>
        <select id="promptSel" class="select" title="Prompt">
          <option value="0">Prompt A</option>
          <option value="1">Prompt B</option>
          <option value="2">Prompt C</option>
          <option value="3">Prompt D</option>
          <option value="4">Prompt E</option>
        </select>
        <button id="startBtn" class="btn secondary">Start</button>
        <button id="resetBtn" class="btn ghost">Reset</button>
        <label class="toggle" title="Enable browser spellcheck on input">
          <input id="spellToggle" type="checkbox" checked>
          Spellcheck
        </label>
      </div>
    </div>

    <div class="row">
      <section class="card">
        <div class="hd">
          <h3>Test Area</h3>
          <div class="chips">
            <span id="stateChip" class="chip">Idle</span>
            <span class="chip" id="timeLeft">—</span>
          </div>
        </div>
        <div class="bd">
          <div class="metrics" aria-live="polite">
            <div class="metric"><h4>Gross WPM</h4><div class="v" id="grossWpm">0</div></div>
            <div class="metric"><h4>Net WPM</h4><div class="v" id="netWpm">0</div></div>
            <div class="metric"><h4>CPM</h4><div class="v" id="cpm">0</div></div>
            <div class="metric"><h4>Accuracy</h4><div class="v" id="accuracy">100%</div></div>
          </div>

          <div class="bd" style="padding:0;margin-top:16px">
            <div class="prompt" id="prompt"></div>
          </div>

          <div class="io">
            <textarea id="input" placeholder="Press Start, then type here…" disabled spellcheck="true"></textarea>
            <div class="range" aria-hidden="true"><div class="bar" id="progressBar"></div></div>
          </div>
        </div>
      </section>

      <aside class="card">
        <div class="hd">
          <h3>Quality & Issues</h3>
          <div class="chips">
            <span class="pill good" id="accPill">Accuracy: 100%</span>
            <span class="pill bad" id="errPill">Errors: 0</span>
          </div>
        </div>
        <div class="bd lists">
          <div class="list">
            <h4>Spelling differences (vs prompt)</h4>
            <ul id="spellingList"></ul>
          </div>
          <div class="list">
            <h4>Grammar hints</h4>
            <ul id="grammarList"></ul>
          </div>
        </div>
      </aside>
    </div>

    <div class="footer">Tip: Accuracy first, speed later. Toggle spellcheck to use the browser's suggestions while you type.</div>
  </div>

  <script>
    // ----- Prompts -----
    const PROMPTS = [
      "The quick brown fox jumps over the lazy dog to test every letter.",
      "Typing is a skill that improves with deliberate practice and good posture.",
      "Clean code is not just for machines; it is also a gift to future you.",
      "Focus on accuracy first; speed will naturally follow with consistent effort.",
      "Small daily habits compound into remarkable results over time."
    ];

    // ----- Elements -----
    const els = {
      prompt: document.getElementById('prompt'),
      input: document.getElementById('input'),
      start: document.getElementById('startBtn'),
      reset: document.getElementById('resetBtn'),
      duration: document.getElementById('duration'),
      promptSel: document.getElementById('promptSel'),
      timeLeft: document.getElementById('timeLeft'),
      bar: document.getElementById('progressBar'),
      grossWpm: document.getElementById('grossWpm'),
      netWpm: document.getElementById('netWpm'),
      cpm: document.getElementById('cpm'),
      accuracy: document.getElementById('accuracy'),
      spellingList: document.getElementById('spellingList'),
      grammarList: document.getElementById('grammarList'),
      stateChip: document.getElementById('stateChip'),
      accPill: document.getElementById('accPill'),
      errPill: document.getElementById('errPill'),
      spellToggle: document.getElementById('spellToggle'),
    };

    // ----- State -----
    let state = {
      seconds: 60,
      running: false,
      timerId: null,
      startTs: null,
      cursor: 0,
      errors: 0,
      correct: 0,
      typed: 0,
      text: PROMPTS[0],
    };

    function setDuration(s){ state.seconds = Number(s); }

    // ----- Render Prompt with per-char spans -----
    function renderPrompt(text){
      els.prompt.innerHTML = '';
      [...text].forEach((ch, i)=>{
        const span = document.createElement('span');
        span.textContent = ch;
        span.className = 'char pending';
        span.dataset.idx = i;
        els.prompt.appendChild(span);
      });
      highlightActive(0);
    }

    function highlightActive(idx){
      [...els.prompt.children].forEach(s=>s.classList.remove('active'));
      const el = els.prompt.children[idx];
      if(el) el.classList.add('active');
    }

    // ----- Controls -----
    els.duration.addEventListener('change', e=> setDuration(e.target.value));
    els.promptSel.addEventListener('change', e=>{
      state.text = PROMPTS[Number(e.target.value)];
      reset(true);
    });
    els.spellToggle.addEventListener('change', e=>{
      els.input.setAttribute('spellcheck', e.target.checked ? 'true': 'false');
    })

    els.start.addEventListener('click', start);
    els.reset.addEventListener('click', ()=> reset(false));

    function start(){
      if(state.running) return;
      state.running = true;
      state.startTs = Date.now();
      els.input.disabled = false;
      els.input.focus();
      els.stateChip.textContent = 'Running';
      tick();
      state.timerId = setInterval(tick, 100);
    }

    function reset(keepPrompt){
      clearInterval(state.timerId); state.timerId = null;
      const text = keepPrompt ? state.text : PROMPTS[els.promptSel.value];
      state = {seconds: Number(els.duration.value), running:false, timerId:null, startTs:null, cursor:0, errors:0, correct:0, typed:0, text};
      renderPrompt(state.text);
      els.input.value = '';
      els.input.disabled = true;
      els.stateChip.textContent = 'Idle';
      els.timeLeft.textContent = `${state.seconds}s`;
      els.bar.style.transform = 'scaleX(0)';
      els.grossWpm.textContent = '0';
      els.netWpm.textContent = '0';
      els.cpm.textContent = '0';
      setAccuracy(100);
      els.errPill.textContent = 'Errors: 0';
      els.spellingList.innerHTML = '';
      els.grammarList.innerHTML = '';
    }

    // Initial render
    renderPrompt(state.text);
    reset(true);

    // ----- Typing Logic -----
    els.input.addEventListener('input', onType);

    function onType(){
      if(!state.running) return;
      const user = els.input.value;
      state.typed = user.length;

      // Compare char-by-char
      const spans = els.prompt.querySelectorAll('.char');
      let errors = 0, correct = 0;
      for(let i=0;i<spans.length;i++){
        const ch = user[i];
        const target = spans[i].textContent;
        if(ch == null){
          spans[i].className = 'char pending';
        }else if(ch === target){
          spans[i].className = 'char correct';
          correct++;
        }else{
          spans[i].className = 'char wrong';
          errors++;
        }
      }
      state.cursor = Math.min(user.length, spans.length);
      state.errors = errors;
      state.correct = correct;
      highlightActive(state.cursor);

      // Stats
      const elapsed = Math.max(0.001, (Date.now()-state.startTs)/1000);
      updateStats(elapsed);

      // Spelling diff vs prompt (word level)
      updateSpelling(user, state.text);

      // Grammar hints (lightweight)
      renderGrammarHints(user);
    }

    function updateStats(elapsedSec){
      const minutes = elapsedSec / 60;
      const grossCpm = Math.max(0, Math.round(state.typed / minutes));
      const grossWpm = Math.max(0, Math.round((state.typed/5) / minutes));
      const netWpm = Math.max(0, Math.round(grossWpm - (state.errors / minutes)));
      const acc = state.typed ? Math.max(0, Math.round((state.correct/state.typed)*100)) : 100;
      els.cpm.textContent = grossCpm.toString();
      els.grossWpm.textContent = grossWpm.toString();
      els.netWpm.textContent = netWpm.toString();
      setAccuracy(acc);
      els.errPill.textContent = `Errors: ${state.errors}`;
    }

    function setAccuracy(acc){
      els.accuracy.textContent = acc + '%';
      els.accPill.textContent = 'Accuracy: ' + acc + '%';
    }

    // ----- Timer / Progress -----
    function tick(){
      const elapsed = Math.min(state.seconds, (Date.now()-state.startTs)/1000);
      const left = Math.max(0, state.seconds - Math.floor(elapsed));
      els.timeLeft.textContent = left + 's';
      const ratio = clamp(elapsed / state.seconds, 0, 1);
      els.bar.style.transform = `scaleX(${ratio})`;
      if(elapsed >= state.seconds){
        clearInterval(state.timerId); state.running=false; els.stateChip.textContent='Done';
        els.input.disabled = true;
      }
    }

    function clamp(n,min,max){return Math.max(min, Math.min(max, n));}

    // ----- Spelling diff (vs. prompt) -----
    function updateSpelling(user, prompt){
      const uWords = user.trim().split(/\s+/).filter(Boolean);
      const pWords = prompt.trim().split(/\s+/).filter(Boolean);
      const items = [];
      for(let i=0;i<Math.min(uWords.length, pWords.length); i++){
        if(uWords[i] && pWords[i] && normalize(uWords[i]) !== normalize(pWords[i])){
          items.push(`<li>Word ${i+1}: “<strong>${escapeHtml(uWords[i])}</strong>” → should be “${escapeHtml(pWords[i])}”</li>`);
        }
      }
      els.spellingList.innerHTML = items.join('');
    }

    function normalize(w){
      return w.replace(/[^a-zA-Z']/g,'').toLowerCase();
    }

    function escapeHtml(s){
      return s.replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
    }

    // ----- Grammar Hints (heuristics) -----
    function renderGrammarHints(text){
      const hints = [];
      if(/\s{2,}/.test(text)) hints.push('Avoid double spaces.');
      if(/\b(\w+)\s+\1\b/i.test(text)) hints.push('Repeated word detected (e.g., “the the”).');
      const sentences = text.split(/(?<=[.!?])\s+/).filter(s=>s.trim());
      sentences.forEach((s, i)=>{
        const trimmed = s.trim();
        if(trimmed.length>0 && /[a-z]/.test(trimmed[0])) hints.push(`Capitalize the start of sentence ${i+1}.`);
        const words = trimmed.split(/\s+/).filter(Boolean);
        if(words.length>30) hints.push(`Sentence ${i+1} is quite long; consider splitting.`);
        if(!/[.!?]$/.test(trimmed)) hints.push(`Sentence ${i+1} may be missing ending punctuation.`);
        if(/\b(was|were|is|are|been|be|being)\s+\w+ed\b/i.test(trimmed)) hints.push(`Possible passive voice in sentence ${i+1}.`);
      });
      // Simple confusion checks
      if(/\byour\b[^\w]*\b(\w+ing|\w+ed|\w+s)\b/i.test(text) && /\byou're\b/i.test(text)===false){
        hints.push('Check “your/you’re” usage.');
      }
      if(/\bits\b\s+\w+/i.test(text) && /\bit's\b/i.test(text)===false && /\bits\b\s+(a|the|an)/i.test(text)===false){
        hints.push('Check “its/it’s” usage.');
      }
      els.grammarList.innerHTML = hints.length ? hints.map(h=>`<li>${h}</li>`).join('') : '<li><span class="pill good">No obvious issues</span></li>';
    }

    // Accessibility: restart with Enter if idle, stop typing when time ends
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !state.running){ start(); }
    });
  </script>
</body>
</html>
